{"ast":null,"code":"import _objectSpread from\"E:\\\\Workspace\\\\mongodb_expressjs_reactjs_nodejs\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"E:\\\\Workspace\\\\mongodb_expressjs_reactjs_nodejs\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"E:\\\\Workspace\\\\mongodb_expressjs_reactjs_nodejs\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"E:\\\\Workspace\\\\mongodb_expressjs_reactjs_nodejs\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import axios from'axios';import{useContext,useState}from'react';import{Link}from'react-router-dom';import{AppContext,deleteOnePost,updateOnePost}from'../../../exportStore';import'../Posts.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PostItem=function PostItem(_ref){var post=_ref.post;var _useContext=useContext(AppContext),state=_useContext.state,dispatch=_useContext.dispatch;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),openEditor=_useState2[0],setOpenEditor=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),deleteConfirm=_useState4[0],setDeleteConfirm=_useState4[1];var _useState5=useState(post),_useState6=_slicedToArray(_useState5,2),postInput=_useState6[0],setPostInput=_useState6[1];var convertDate=function convertDate(date){var newDate=new Date(date);var month=newDate.getMonth()+1;var day=newDate.getDate();var year=newDate.getFullYear();if(day<10){day='0'+day;}if(month<10){month='0'+month;}return\"\".concat(day,\"/\").concat(month,\"/\").concat(year);};var openEditorHandler=function openEditorHandler(){if(openEditor){setOpenEditor(false);}else{setOpenEditor(true);}};var deleteConfirmHandler=function deleteConfirmHandler(){if(deleteConfirm){setDeleteConfirm(false);}else{setDeleteConfirm(true);}};var onUpdateHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var token,option,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setOpenEditor(false);token=localStorage.getItem('token');option={method:'PUT',url:\"api/v1/posts/update/\".concat(post._id),headers:{'Authorization':\"Bearer \".concat(token)},data:postInput};_context.next=6;return axios(option);case 6:response=_context.sent;dispatch(updateOnePost(response.data.data));window.location.reload();_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function onUpdateHandler(_x){return _ref2.apply(this,arguments);};}();var onDeleteHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var token,option,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;token=localStorage.getItem('token');option={method:'DELETE',url:\"api/v1/posts/delete/\".concat(post._id),headers:{'Authorization':\"Bearer \".concat(token)}};_context2.next=5;return axios(option);case 5:response=_context2.sent;dispatch(deleteOnePost(response.data.data._id));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function onDeleteHandler(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"li\",{className:\"post-list-item mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-list-item-top\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"post-list-item-text\",children:post.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-list-item-info d-flex flex-wrap mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-list-info-left d-flex flex-align-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"badge badge-warning mr-3\",children:/*#__PURE__*/_jsxs(Link,{to:\"#\",className:\"info-left-author\",children:[\"by: \",post.author.username]})}),/*#__PURE__*/_jsxs(\"span\",{className:\"info-left-date badge badge-light\",children:[\"Date: \",/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:convertDate(post.createdAt)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-list-info-right d-flex ml-auto\",children:state.user===post.author.username&&/*#__PURE__*/_jsxs(_Fragment,{children:[!deleteConfirm&&/*#__PURE__*/_jsxs(\"div\",{className:\"right-actions mt-3\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:openEditorHandler,className:\"action-edit mr-2 btn btn-primary\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"span\",{onClick:deleteConfirmHandler,className:\"action-delete btn btn-danger\",children:\"Delete\"})]}),deleteConfirm&&/*#__PURE__*/_jsxs(\"div\",{className:\"right-confirm mt-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"badge badge-warning\",children:/*#__PURE__*/_jsx(Link,{to:\"#\",className:\"confirm-question text-underline\",children:\"Are you sure?\"})}),/*#__PURE__*/_jsx(\"span\",{onClick:onDeleteHandler,className:\"confirm-yes mx-2 btn btn-danger\",children:\"Yes\"}),/*#__PURE__*/_jsx(\"span\",{onClick:deleteConfirmHandler,className:\"confirm-no btn btn-primary\",children:\"No\"})]})]})})]})]}),openEditor&&!deleteConfirm&&/*#__PURE__*/_jsx(\"div\",{className:\"post-list-item-bottom mt-3\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"form-item-bottom-updates\",onSubmit:onUpdateHandler,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"textarea\",{className:\"form-control\",id:\"content\",name:\"content\",rows:\"5\",value:postInput.content,onChange:function onChange(e){return setPostInput(_objectSpread(_objectSpread({},postInput),{},{content:e.target.value}));}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group d-flex\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"btn btn-warning ml-auto mr-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-edit\"}),\" Update\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-primary\",onClick:openEditorHandler,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-external-link-alt\"}),\" Cancel\"]})]})]})})]})});};export default PostItem;","map":{"version":3,"sources":["E:/Workspace/mongodb_expressjs_reactjs_nodejs/frontend/src/components/Posts/PostItem/PostItem.js"],"names":["axios","useContext","useState","Link","AppContext","deleteOnePost","updateOnePost","PostItem","post","state","dispatch","openEditor","setOpenEditor","deleteConfirm","setDeleteConfirm","postInput","setPostInput","convertDate","date","newDate","Date","month","getMonth","day","getDate","year","getFullYear","openEditorHandler","deleteConfirmHandler","onUpdateHandler","e","token","localStorage","getItem","option","method","url","_id","headers","data","response","window","location","reload","console","log","onDeleteHandler","content","author","username","createdAt","user","target","value"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport { useContext, useState } from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {AppContext, deleteOnePost, updateOnePost} from '../../../exportStore';\r\nimport '../Posts.css';\r\n\r\nconst PostItem = ({post}) => {\r\n    const {state, dispatch} = useContext(AppContext);\r\n    const [openEditor, setOpenEditor] = useState(false);\r\n    const [deleteConfirm, setDeleteConfirm] = useState(false);\r\n    const [postInput, setPostInput] = useState(post);\r\n    const convertDate = (date) => {\r\n        const newDate = new Date(date);\r\n        let month = newDate.getMonth() + 1;\r\n        let day = newDate.getDate();\r\n        let year = newDate.getFullYear();\r\n        if(day < 10) {\r\n            day = '0' + day;\r\n        }\r\n        if(month < 10) {\r\n            month = '0' + month;\r\n        }\r\n        return `${day}/${month}/${year}`;\r\n    }\r\n    const openEditorHandler = () => {\r\n        if(openEditor){\r\n            setOpenEditor(false);\r\n        }else{\r\n            setOpenEditor(true);\r\n        }\r\n    }\r\n    const deleteConfirmHandler = () => {\r\n        if(deleteConfirm){\r\n            setDeleteConfirm(false);\r\n        }else{\r\n            setDeleteConfirm(true);\r\n        }\r\n    }\r\n    const onUpdateHandler = async (e) => {\r\n        try{\r\n            setOpenEditor(false);\r\n            const token = localStorage.getItem('token');\r\n            const option = {\r\n                method: 'PUT',\r\n                url: `api/v1/posts/update/${post._id}`,\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                },\r\n                data: postInput\r\n            }\r\n            const response = await axios(option);\r\n            dispatch(updateOnePost(response.data.data));\r\n            window.location.reload();\r\n        }catch(err){\r\n            console.log(err);\r\n        }\r\n    }\r\n    const onDeleteHandler = async (e) => {\r\n        try{\r\n            const token = localStorage.getItem('token');\r\n            const option = {\r\n                method: 'DELETE',\r\n                url: `api/v1/posts/delete/${post._id}`,\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                }\r\n            }\r\n            const response = await axios(option);\r\n            dispatch(deleteOnePost(response.data.data._id));\r\n        }catch(err){\r\n            console.log(err);\r\n        }\r\n    }\r\n    return (\r\n        <>\r\n            <li className='post-list-item mb-3'>\r\n                <div className='post-list-item-top'>\r\n                    <p className='post-list-item-text'>{post.content}</p>\r\n                    <div className='post-list-item-info d-flex flex-wrap mt-4'>\r\n                        <div className='post-list-info-left d-flex flex-align-center'>\r\n                            <span className=\"badge badge-warning mr-3\">\r\n                                <Link to=\"#\" className='info-left-author'>by: {post.author.username}</Link>\r\n                            </span>\r\n                            <span className='info-left-date badge badge-light'>Date: <span className='date'>{convertDate(post.createdAt)}</span></span>\r\n                        </div>\r\n                        <div className='post-list-info-right d-flex ml-auto'>\r\n                            {state.user === post.author.username &&\r\n                                <>\r\n                                    {!deleteConfirm && \r\n                                        <div className='right-actions mt-3'>\r\n                                            <span onClick={openEditorHandler} className='action-edit mr-2 btn btn-primary'>Edit</span>\r\n                                            <span onClick={deleteConfirmHandler} className='action-delete btn btn-danger'>Delete</span>\r\n                                        </div>\r\n                                    }\r\n                                    {deleteConfirm &&\r\n                                        <div className='right-confirm mt-3'>\r\n                                            <span className=\"badge badge-warning\">\r\n                                                <Link to=\"#\" className='confirm-question text-underline'>Are you sure?</Link>\r\n                                            </span>\r\n                                            <span onClick={onDeleteHandler} className='confirm-yes mx-2 btn btn-danger'>\r\n                                                Yes\r\n                                            </span>\r\n                                            <span onClick={deleteConfirmHandler} className='confirm-no btn btn-primary'>No</span>\r\n                                        </div>\r\n                                    }\r\n                                </>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                {openEditor && !deleteConfirm &&\r\n                    <div className='post-list-item-bottom mt-3'>\r\n                        <form className='form-item-bottom-updates' onSubmit={onUpdateHandler}>\r\n                            <div className='form-group'>\r\n                                <textarea className='form-control' id='content' name='content' rows='5' value={postInput.content} onChange={(e) => setPostInput({...postInput, content: e.target.value})}/>\r\n                            </div>\r\n                            <div className='form-group d-flex'>\r\n                                <button type=\"submit\" className='btn btn-warning ml-auto mr-2'>\r\n                                    <i className=\"fas fa-edit\"></i> Update</button>\r\n                                <span className='btn btn-primary' onClick={openEditorHandler}>\r\n                                    <i className=\"fas fa-external-link-alt\"></i> Cancel</span>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                }\r\n            </li>\r\n        </>\r\n    )\r\n}\r\nexport default PostItem;"]},"metadata":{},"sourceType":"module"}